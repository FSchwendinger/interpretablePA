---
title: "Interpreting cut-point-free physical activity metrics in children using interpret.pa.children()"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Interpret PA in Children}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(interpretablePA)
```

## Overview

The `interpret.pa.children()` function from the `interpretablePA` package provides centile-based interpretation of physical activity metrics in children (age 5 to 15). It uses reference values from the [Fairclough et al. (2023) study](https://doi.org/10.1186/s12966-023-01435-z), which established age- and sex-specific centile curves for accelerometer-assessed physical activity.

This vignette walks through how to apply this function using subject demographic data and GGIR part 2 summary output.

## Required Inputs

-    A CSV or Excel file with **ID**, **sex**, and **age**

-    A GGIR part 2 summary file containing:

    -    `AD_mean_ENMO_mg_0.24hr` (average acceleration)

    -    `AD_ig_gradient_ENMO_0.24hr` (intensity gradient)

## Example Workflow

### Simulate example input files

```{r}
# Simulated subject demographic data
subject_data <- data.frame(
  ID = c("001", "002", "003"),
  sex = c("0", "1", "0"),
  age = c(6.5, 10.2, 13.8)
)

# Simulated GGIR part 2 summary
ggir_data <- data.frame(
  ID = c("001", "002", "003"),
  AD_mean_ENMO_mg_0.24hr = c(60, 70, 75),
  AD_ig_gradient_ENMO_0.24hr = c(-2.35, -2.15, -2.05)
)

# Save the files
write.csv(subject_data, "child_subjects.csv", row.names = FALSE)
write.csv(ggir_data, "child_part2_summary.csv", row.names = FALSE)

```

### Run the function

```{r}
interpret.pa.children(
  dat_path = "child_subjects.csv",
  part2_path = "child_part2_summary.csv",
  output_path = "child_results.csv",
  col_id = "ID",
  col_sex = "sex",
  col_age = "age",
  sex_code_male = "0",
  sex_code_female = "1"
)
```

## Output

The function returns and saves a CSV file with the following:

| ID  | sex | age  | avacc | ig    | avacc_centile | ig_centile |
|-----|-----|------|-------|-------|---------------|------------|
| 001 | m   | 6.5  | 60    | -2.35 | 40            | 10th       |
| 002 | f   | 10.2 | 70    | -2.15 | 75th          | 50th       |
| ... | ... | ...  | ...   | ...   | ...           | ...        |

Percentiles are **interpolated** and rounded to one decimal place. Values outside the 3rd or 95th centile are labeled as `"below 3rd percentile"` or `"above 95th percentile"`.

## Citations

Please cite both of the following references when using this function in publications:

> 
>
> **Fairclough S.J., Noonan R.J., Rowlands A.V., Boddy L.M., Davies I.G., Ridgers N.D., Mackintosh K.A., & Knowles Z.R. (2023)**. Centile curves for accelerometer‐assessed physical activity and sedentary time in English children. *International Journal of Behavioral Nutrition and Physical Activity*, 20(1), 1–12. <https://doi.org/10.1186/s12966-023-01435-z>

> 
>
> **Schwendinger F., Wagner J., Knaier R., Infanger D., Rowlands A.V., Hinrichs T., & Schmidt-Trucksaess A. (2024)**. Accelerometer Metrics: Healthy Adult Reference Values, Associations with Cardiorespiratory Fitness, and Clinical Implications. *Medicine and Science in Sports and Exercise*, 56(2), 170–180. <https://doi.org/10.1249/MSS.0000000000003299>

## Notes

-    For adult interpretation, use the `interpret.pa()` function.

-    This vignette is specific to the **children’s reference dataset** from Fairclough et al.

## Troubleshooting

-    Ensure that the `sex_code_male` and `sex_code_female` match your data

-   All IDs must appear in both files (`dat_path` and `part2_path`)

-    Non-numeric or missing values in age or PA metrics will be excluded
